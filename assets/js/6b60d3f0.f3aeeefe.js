(self.webpackChunkintilery=self.webpackChunkintilery||[]).push([[1814],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return d}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=l(n),d=a,f=m["".concat(c,".").concat(d)]||m[d]||u[d]||i;return n?r.createElement(f,o(o({ref:t},p),{},{components:n})):r.createElement(f,o({ref:t},p))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var l=2;l<i;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7905:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return l},toc:function(){return p},default:function(){return m}});var r=n(2122),a=n(9756),i=(n(7294),n(3905)),o=["components"],s={id:"marketing_prefs_hosting",title:"Hosting your own Marketing Preferences page",sidebar_label:"Hosting Marprefs"},c="Marketing Preferences Hosting",l={unversionedId:"tag/marketing_prefs_hosting",id:"tag/marketing_prefs_hosting",isDocsHomePage:!1,title:"Hosting your own Marketing Preferences page",description:"Intilery host a basic marketing preferences page which is linked to in all of our email communications.  This can be used by the customer to subscribe or opt out of communications based on communication medium (channel) or subscription category (interests).",source:"@site/docs/tag/marketing_prefs_hosting.md",sourceDirName:"tag",slug:"/tag/marketing_prefs_hosting",permalink:"/docs/tag/marketing_prefs_hosting",version:"current",frontMatter:{id:"marketing_prefs_hosting",title:"Hosting your own Marketing Preferences page",sidebar_label:"Hosting Marprefs"}},p=[{value:"Page URL",id:"page-url",children:[]},{value:"Example page",id:"example-page",children:[]},{value:"Retrieving marketing preferences for the customer",id:"retrieving-marketing-preferences-for-the-customer",children:[{value:"Request endpoint",id:"request-endpoint",children:[]},{value:"Example response",id:"example-response",children:[]}]},{value:"Update the marketing preferences for the customer",id:"update-the-marketing-preferences-for-the-customer",children:[{value:"Request endpoint",id:"request-endpoint-1",children:[]},{value:"Example code",id:"example-code",children:[]},{value:"Example response",id:"example-response-1",children:[]}]},{value:"Unsubscribing from all communications",id:"unsubscribing-from-all-communications",children:[]}],u={toc:p};function m(e){var t=e.components,s=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"marketing-preferences-hosting"},"Marketing Preferences Hosting"),(0,i.kt)("p",null,"Intilery host a basic marketing preferences page which is linked to in all of our email communications.  This can be used by the customer to subscribe or opt out of communications based on communication medium (channel) or subscription category (interests)."),(0,i.kt)("p",null,"If a custom version of this page is required, it can be self-hosted."),(0,i.kt)("h1",{id:"what-the-page-will-need-to-do"},"What the page will need to do"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Retrieve marketing preferences for the customer from the Intilery endpoint"),(0,i.kt)("li",{parentName:"ul"},"Update the marketing preferences for the customer by building a new preferences object and POSTing to our endpoint")),(0,i.kt)("h2",{id:"page-url"},"Page URL"),(0,i.kt)("p",null,"The default page is hosted at:\n",(0,i.kt)("a",{parentName:"p",href:"https://marketingprefs.intilery.com/content?s=aW50aWxlcnk6bWFya2V0aW5nOjg1MWZlMjM1LWY3MTEtNGVkZS05N2ZkLWFhOWUxNWIzOTg0YQ=="},"https://marketingprefs.intilery.com/content?s=aW50aWxlcnk6bWFya2V0aW5nOjg1MWZlMjM1LWY3MTEtNGVkZS05N2ZkLWFhOWUxNWIzOTg0YQ==")),(0,i.kt)("p",null,"The ",(0,i.kt)("em",{parentName:"p"},"s")," parameter is an important property applied to all customers called the ",(0,i.kt)("em",{parentName:"p"},"Subscription ID"),".  For custom hosting, this parameter can of course be named as desired.  The merge tag for a customers subscription id is:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'{(customer._subscriptionId)!""}\n')),(0,i.kt)("p",null,"So the example link above might be generated in our email editor with..."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'https://marketingprefs.intilery.com/content?s={(customer._subscriptionId)!""}\n')),(0,i.kt)("p",null,"The above would need be replaced with the URL of your own hosted page.  The URL parameter name can of course be changed to suit but the merge tag ",(0,i.kt)("em",{parentName:"p"},"must")," remain the same as this property of the customer cannot be renamed."),(0,i.kt)("h2",{id:"example-page"},"Example page"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Marketing Preferences",src:n(3046).Z})),(0,i.kt)("h2",{id:"retrieving-marketing-preferences-for-the-customer"},"Retrieving marketing preferences for the customer"),(0,i.kt)("p",null,'A single endpoint returns the customers marketing preferences with the list of known channels and subscription categories.\nNote that channels are "opt-in" and categories are "opt-out".  If a new subscription category is added, the default status of that category for the customer will be ',(0,i.kt)("em",{parentName:"p"},"subscribed"),"."),(0,i.kt)("h3",{id:"request-endpoint"},"Request endpoint"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"GET https://events.intilery.com/cdp/marketing-preferences/<subscriptionId>\n")),(0,i.kt)("p",null,"For example..."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"GET https://events.intilery.com/cdp/marketing-preferences/276db9bf-ac46-4dc3-bb7d-e94a7eb1de51\n")),(0,i.kt)("h3",{id:"example-response"},"Example response"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'{\n    "writeKey": "ZXhhbXBsZTpleGFtcGxlOkVYQU1QTEU=",\n    "customerId": "276db9bf-ac46-4dc3-bb7d-e94a7eb1de51",\n    "channels": [{\n        "channel": "email",\n        "name": "Email",\n        "subscribed": true\n    }, {\n        "channel": "sms",\n        "name": "SMS",\n        "subscribed": false\n    }],\n    "categories": [{\n        "category": "marketing tricks",\n        "name": "marketing_tricks",\n        "subscribed": true\n    }, {\n        "category": "new product alerts",\n        "name": "new_product_alerts",\n        "subscribed": true\n    }],\n    "unsubscribeAll": false\n}\n')),(0,i.kt)("h2",{id:"update-the-marketing-preferences-for-the-customer"},"Update the marketing preferences for the customer"),(0,i.kt)("h3",{id:"request-endpoint-1"},"Request endpoint"),(0,i.kt)("p",null,"The same endpoint used to retrieve the customer marketing preferences is also used to update. Only the method is different."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"POST https://events.intilery.com/cdp/marketing-preferences/<subscription id>\n")),(0,i.kt)("h3",{id:"example-code"},"Example code"),(0,i.kt)("p",null,"The example POST below updates the example customers marketing preferences as follows:-"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Unsubscribe from the new_product_alerts subscription category"),(0,i.kt)("li",{parentName:"ul"},"Subscribe to the SMS channel\nNote that the category/channel fields match up to those in the retrieved preferences.\nWe recommend calling this endpoint from your servers to avoid any browser related CORS or blocking issues.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'const data = {\n    "categories": [{\n        "category": "marketing_tricks",\n        "subscribed": true\n    }, {\n        "category": "new_product_alerts",\n        "subscribed": false\n    }],\n    "channels": [{\n        "channel": "email",\n        "subscribed": true\n    }, {\n        "channel": "sms",\n        "subscribed": true\n    }],\n    "unsubscribeAll": false,\n    "unsubscribeReason": ""\n};\n$.ajax({\n    type: \'POST\',\n    url: `https://events.intilery.com/cdp/marketing-preferences/276db9bf-ac46-4dc3-bb7d-e94a7eb1de51`,\n    crossDomain: true,\n    contentType: \'application/json; charset=utf-8\',\n    data: JSON.stringify(data),\n    success: function () {\n        alert("marketing preferences updated");\n    }\n});\n')),(0,i.kt)("h3",{id:"example-response-1"},"Example response"),(0,i.kt)("p",null,"The endpoint will return a 200 response to indicate success."),(0,i.kt)("h2",{id:"unsubscribing-from-all-communications"},"Unsubscribing from all communications"),(0,i.kt)("p",null,"Send the following data to the endpoint"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'{\n    "categories": [],\n    "channels": [],\n    "unsubscribeAll": true,\n    "unsubscribeReason": "" // can be set to a string value to be recorded against the customer for your own records\n};\n')))}m.isMDXComponent=!0},3046:function(e,t,n){"use strict";t.Z=n.p+"assets/images/marprefs_eg-3bdaf91b670d7405f86a012886e7bd28.png"}}]);